<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Order Confirmation</title>
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© ë° jQuery ë§í¬ ì¶”ê°€ -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>
    <script>

        function redirectToMyPage() {
        // "/order_completed" URLë¡œ ë¦¬ë””ë ‰ì…˜
        window.location.href = "/order_completed";
    }

        // ì•„ì„í¬íŠ¸ ì´ˆê¸°í™” ë° ì¹´ë“œê²°ì œ ìš”ì²­
        function requestCardPayment() {
            console.log('requestCardPayment í•¨ìˆ˜ í˜¸ì¶œë¨');
            var finalPaymentAmount = parseFloat(document.querySelector('.final').textContent);
            var merchant_uid = 'merchant_' + new Date().getTime();

            IMP.init('iamport');
            IMP.request_pay({
                pg: "inicis",
                pay_method: "card",
                merchant_uid: merchant_uid,
                name: 'joinair',
                amount: finalPaymentAmount,
                buyer_email: 'iamport@siot.do',
                buyer_name: 'êµ¬ë§¤ì',
                buyer_tel: '010-1234-5678',
                buyer_addr: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì‚¼ì„±ë™',
                buyer_postcode: '123-456'
            },function (rsp) {
            if (rsp.success) {
                var msg = 'ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                alert(msg);
                // "/order_completed" URLë¡œ ë¦¬ë””ë ‰ì…˜í•˜ëŠ” í•¨ìˆ˜ í˜¸ì¶œ
                redirectToMyPage();
            } else {
                var msg = 'ê²°ì œì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.';
                msg += 'ì—ëŸ¬ë‚´ìš© : ' + rsp.error_msg;
                alert(msg);
            }
        });
    }

        // ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
        function openPaymentModal() {
            console.log('openPaymentModal í•¨ìˆ˜ í˜¸ì¶œë¨');
            $('#paymentCompleteModal').modal('show');
        }

        // ëª¨ë‹¬ ì•ˆì—ì„œ ì¹´ë“œê²°ì œ ë²„íŠ¼ í´ë¦­ ì‹œ ê²°ì œ ìš”ì²­
        function completeCardPayment() {
            // ëª¨ë‹¬ì„ ë‹«ì„ ìˆ˜ ìˆìœ¼ë©´ ë‹«ìŒ
            $('#paymentCompleteModal').modal('hide');
            // ìµœì¢… ê²°ì œê¸ˆì•¡ í‘œì‹œë¥¼ ìƒëµí•˜ê³  ë°”ë¡œ ê²°ì œ ìš”ì²­
            requestCardPayment();
        }
    </script>
</head>
</head>
<body>

<!-- ì²« ë²ˆì§¸ ë„¤ë¸Œë°” -->
<nav class="navbar navbar-expand-lg bg-dark navbar-light d-none d-lg-block" id="templatemo_nav_top">
    <div class="container text-light">
        <div class="w-100 d-flex justify-content-between">
            <div>
                <i class="fa fa-envelope mx-2"></i>
                <a class="navbar-sm-brand text-light text-decoration-none" href="mailto:info@company.com"> Doron delivery@Doron delivery.com

                </a>
                <i class="fa fa-phone mx-2"></i>
                <a class="navbar-sm-brand text-light text-decoration-none" href="tel:010-020-0340">010-1234-4567</a>
            </div>
            <div>
                <div>
                    <span th:if="${userId != null and (userId != 'anonymousUser')}">ğŸ’« <span th:text="${userId}"></span> ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤ ğŸ’«</span>
                    <span sec:authorize="hasAuthority('admin')">
                        <a th:href="@{/adminWelcome}" class="nav-link" style="display: inline-block; margin-left: 10px;">ê´€ë¦¬ì í˜ì´ì§€</a></span>

                    <!-- ì‚¬ìš©ìì˜ ë§ˆì¼ë¦¬ì§€ í‘œì‹œ -->
                    <span th:if="${userMileage != null}">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <span th:text="${userMileage}"></span> ë§ˆì¼ë¦¬ì§€ </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;


                    <!--                <span class="connected-id" th:if="${userId != null and userAuthorities == 'admin' }">ğŸ’« <span th:text="${userId}"></span> ë‹˜1 í™˜ì˜í•©ë‹ˆë‹¤ ğŸ’«</span>-->
                    <!--                <span sec:authorize="principal.authorities('admin', 'user') and isAuthenticated()">ğŸ’« <span sec:authentication="principal.username"></span> ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤ ğŸ’«</span>-->


                    <!-- ì‚¬ìš©ì ê¶Œí•œì— ë”°ë¼ ì¶”ê°€ì ì¸ ì •ë³´ í‘œì‹œ (ì˜ˆ: ê´€ë¦¬ì ì—¬ë¶€) -->
                    <!--                <span sec:authorize="hasRole('ADMIN')"> (ê´€ë¦¬ì) </span>-->


                    <!--                <span th:if="${userAuthorities.contains('admin')}"> (ê´€ë¦¬ì) </span>-->
                    <!--                <span class="connected-id" th:if="${session.User_Id != null}">ğŸ’« <span th:text="${session.User_Id}"></span> ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤ ğŸ’«</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                    <a class="text-light" href="https://fb.com/templatemo" target="_blank" rel="sponsored"><i class="fab fa-facebook-f fa-sm fa-fw me-2"></i></a>
                    <a class="text-light" href="https://www.instagram.com/" target="_blank"><i class="fab fa-instagram fa-sm fa-fw me-2"></i></a>
                    <a class="text-light" href="https://twitter.com/" target="_blank"><i class="fab fa-twitter fa-sm fa-fw me-2"></i></a></span>
                </div>

            </div>
        </div>
    </div>
</nav>
<div class="container mt-5">
    <h1 class="text-center mb-4">ì£¼ë¬¸ í™•ì¸</h1>
    <div class="alert alert-success" role="alert">
        ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ì œë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”.
    </div>
    <h3 class="text-center mb-4">ì£¼ë¬¸ ë‚´ìš©</h3>
    <div class="table-responsive">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">ì£¼ë¬¸ë²ˆí˜¸</th>
                <th scope="col">ì£¼ë¬¸ìƒì„¸ë²ˆí˜¸</th>
                <th scope="col">ìƒí’ˆëª…</th>
                <th scope="col">ê°€ê²©</th>
                <th scope="col">ìˆ˜ëŸ‰</th>
                <th scope="col">ë¬´ê²Œ(g)</th>
                <th scope="col">ê¸ˆì•¡</th>
            </tr>
            </thead>
            <tbody th:each="detail : ${orderDetails}">
            <tr>
                <td th:text="${detail.orders_Num}"></td>
                <td th:text="${detail.OD_Num}"></td>
                <td th:text="${detail.OD_Pro_Name}"></td>
                <td th:text="${detail.OD_Pro_Price}"></td>
                <td th:text="${detail.OD_Qua}"></td>
                <td th:text="${detail.OD_Totalweight}"></td>
                <td th:text="${detail.OD_Total_Price}"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <h3 class="text-center mb-4">ì£¼ë¬¸ ì •ë³´</h3>
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    ì´ ë¬´ê²Œ
                    <span class="badge badge-primary badge-pill" th:text="${order.orders_Totalweight}" id="totalWeightBadge"></span>
                </li>

                <li class="list-group-item d-flex justify-content-between align-items-center">
                    TOTAL PRICE
                    <span th:text="${order.orders_Total_Price}" class="badge badge-primary badge-pill final"></span>
                </li>
            </ul>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" style="margin: auto; display: block;" onclick="openPaymentModal()">ì™„ë£Œ</button><br>
    </div>

    <!-- ëª¨ë‹¬ ì¶”ê°€ -->
    <div class="modal fade" id="paymentCompleteModal" tabindex="-1" role="dialog" aria-labelledby="paymentCompleteModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentCompleteModalLabel">ê²°ì œ</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ê²°ì œë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="completeCardPayment()">ì¹´ë“œê²°ì œ</button>
                </div>
            </div>
        </div>
    </div>


    <div class="text-center mt-4">
        <a href="/index" class="btn btn-primary">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
</div>
</body>
</html>
